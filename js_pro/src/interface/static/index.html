<!doctype html>
<html data-theme="dark" lang="ja">
<head>
    <meta charset="UTF-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Ollama Proxy Admin</title>
    <link
            href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"
            rel="stylesheet"
    />
    <link href="/admin/static/css/custom.css" rel="stylesheet"/>
</head>
<body>
<div class="container" id="app" v-cloak>
    <header class="app-header">
        <h1>
            <i class="ph ph-robot app-icon"></i>
            Ollama Proxy
        </h1>
        <div class="actions">
            <button :aria-busy="reloading" @click="reloadConfig" class="outline">
                <i class="ph ph-arrows-clockwise"></i> Reload
            </button>
        </div>
    </header>

    <nav class="tabs">
        <button
                :class="{ active: currentTab === tab.id }"
                :key="tab.id"
                @click="currentTab = tab.id"
                v-for="tab in tabs"
        >
            <i :class="tab.icon"></i> {{ tab.label }}
        </button>
    </nav>

    <section class="tab-content" v-if="currentTab === 'models'">
        <div class="section-header">
            <h2>Models ({{ models.length }})</h2>
            <button @click="openAddModel">
                <i class="ph ph-plus"></i> Add Model
            </button>
        </div>

        <div class="empty-state" v-if="models.length === 0">
            <i class="ph ph-robot empty-icon"></i>
            <p>No models configured</p>
            <button @click="openAddModel">Add your first model</button>
        </div>

        <div class="card-list" v-else>
            <div :key="model.name" class="card" v-for="model in models">
                <div class="card-content">
                    <strong>{{ model.name }}</strong>
                    <span class="secondary badge">
                {{ model.provider }}/{{ model.model_name }}
              </span>
                </div>
                <div class="card-actions">
                    <button @click="editModel(model)" class="outline" title="Edit">
                        <i class="ph ph-pencil"></i>
                    </button>
                    <button
                            @click="deleteModel(model.name)"
                            class="outline"
                            title="Delete"
                    >
                        <i class="ph ph-trash"></i>
                    </button>
                </div>
            </div>
        </div>
    </section>

    <section class="tab-content" v-if="currentTab === 'providers'">
        <div class="section-header">
            <h2>Providers ({{ providers.length }})</h2>
            <button @click="openAddProvider">
                <i class="ph ph-plus"></i> Add Provider
            </button>
        </div>

        <div class="empty-state" v-if="providers.length === 0">
            <i class="ph ph-plug empty-icon"></i>
            <p>No providers configured</p>
        </div>

        <div class="card-list" v-else>
            <div :key="provider.id" class="card" v-for="provider in providers">
                <div class="card-content">
                    <strong>{{ provider.id }}</strong>
                    <span class="secondary badge">{{ provider.provider }}</span>
                </div>
                <div class="card-actions">
                    <button
                            @click="editProvider(provider)"
                            class="outline"
                            title="Edit"
                    >
                        <i class="ph ph-pencil"></i>
                    </button>
                    <button
                            @click="deleteProvider(provider.id)"
                            class="outline"
                            title="Delete"
                    >
                        <i class="ph ph-trash"></i>
                    </button>
                </div>
            </div>
        </div>
    </section>

    <section class="tab-content" v-if="currentTab === 'settings'">
        <h2>Settings</h2>
        <form @submit.prevent="saveSettings" class="settings-form">
            <label>
                Host
                <input placeholder="127.0.0.1" type="text" v-model="config.host"/>
            </label>
            <label>
                Port
                <input
                        placeholder="11434"
                        type="number"
                        v-model.number="config.port"
                />
            </label>
            <label>
                Log Level
                <select v-model="config.log_level">
                    <option value="debug">Debug</option>
                    <option value="info">Info</option>
                    <option value="warn">Warn</option>
                    <option value="error">Error</option>
                </select>
            </label>
            <div class="form-actions">
                <button type="submit">Save Settings</button>
            </div>
        </form>
    </section>

    <dialog :open="isModelModalOpen" class="modal">
        <article class="modal-content">
            <header class="modal-header">
                <h3>{{ editingModel ? 'Edit Model' : 'Add Model' }}</h3>
                <button @click="closeModelModal" class="outline close-btn">
                    ✕
                </button>
            </header>
            <form @submit.prevent="saveModel" class="modal-form">
                <label>
                    Model Name (Ollama)
                    <input
                            :disabled="!!editingModel"
                            placeholder="gpt-4o"
                            required
                            v-model="modelForm.name"
                    />
                </label>
                <label>
                    Provider
                    <select required v-model="modelForm.provider">
                        <option :key="p" :value="p" v-for="p in availableProviders">
                            {{ p }}
                        </option>
                    </select>
                </label>
                <label>
                    Actual Model ID
                    <input
                            placeholder="gpt-4o"
                            required
                            v-model="modelForm.model_name"
                    />
                </label>
                <footer class="modal-footer">
                    <button @click="closeModelModal" class="outline" type="button">
                        Cancel
                    </button>
                    <button type="submit">Save</button>
                </footer>
            </form>
        </article>
    </dialog>

    <dialog :open="isProviderModalOpen" class="modal">
        <article class="modal-content">
            <header class="modal-header">
                <h3>{{ editingProvider ? 'Edit Provider' : 'Add Provider' }}</h3>
                <button @click="closeProviderModal" class="outline close-btn">
                    ✕
                </button>
            </header>
            <form @submit.prevent="saveProvider" class="modal-form">
                <label>
                    Provider ID
                    <input
                            :disabled="!!editingProvider"
                            placeholder="my-openai"
                            required
                            v-model="providerForm.id"
                    />
                </label>
                <label>
                    Provider Type
                    <select required v-model="providerForm.provider">
                        <option :key="p" :value="p" v-for="p in availableProviders">
                            {{ p }}
                        </option>
                    </select>
                </label>
                <label>
                    API Key
                    <input
                            placeholder="sk-..."
                            type="password"
                            v-model="providerForm.api_key"
                    />
                </label>
                <label>
                    Base URL (Optional)
                    <input
                            placeholder="https://api.openai.com/v1"
                            v-model="providerForm.base_url"
                    />
                </label>
                <footer class="modal-footer">
                    <button @click="closeProviderModal" class="outline" type="button">
                        Cancel
                    </button>
                    <button type="submit">Save</button>
                </footer>
            </form>
        </article>
    </dialog>

    <Transition name="toast">
        <div :class="['toast', toast.type]" v-if="toast">
            <i :class="toastIcon"></i>
            {{ toast.message }}
        </div>
    </Transition>
</div>

<script src="https://unpkg.com/@phosphor-icons/web"></script>
<script src="/admin/static/js/app.js" type="module"></script>
</body>
</html>
